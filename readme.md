### 项目简介

- 一款 Chrome 扩展，用于在前端无后端接口时对 XHR/Fetch 请求进行 Mock，支持分组管理、Swagger 一键生成、导入/导出、**支持请求拦截记录一键转换为Mock规则**、也可自定义Mock规则。
- MV3 架构，拦截层通过页面脚本在 document_start 注入，配合 declarativeNetRequest 做部分请求头/重定向修改。

### 安装与启动

1. 克隆/下载本项目代码。
2. 打开 Chrome 访问 `chrome://extensions`，开启“开发者模式”。
3. 点击“加载已解压的扩展程序”，选择项目根目录 `MockSnap`。
4. 点击工具栏扩展图标或使用快捷键打开配置页：
   - 快捷键：Windows/Linux/ChromeOS：Ctrl+M；macOS：Command+M

### 核心能力

- 分组管理 Mock 规则：同一域名或项目的接口放入同一分组，便于统一开关与维护。
- 多种 Mock 方式：
  - Modify API Response（normal / swagger）：直接返回 Mock 数据（不触发真实网络）。
  - Modify Headers：在请求发出前设置请求头。
  - Modify Request Body：在请求发出前修改请求体（主要用于 POST/PUT）。
  - Redirect Request：将请求重定向到其他 URL。
- 匹配方式：
  - contains：URL 包含匹配。
  - equals：URL 等于匹配（相对地址会按 `location.origin + path` 比较）。
  - regexp：正则匹配（可用 `/pattern/` 风格）。
- 请求体匹配：配置了 Request Body 的规则，仅当请求体 JSON 结构与配置完全一致时才命中（内部会做 key 排序再比较）。
- 延迟与状态码：支持设置延迟返回与自定义状态码。
- Swagger 自动生成：
  - 在“编辑分组”中配置 Swagger V2 文档地址（可设置请求头），在新增/编辑规则时选择 Mock 方式为 swagger，选择对应 API 自动生成返回数据。
  - 可配置数组长度/递归深度、并支持“API 包装”统一加壳。
- 导入/导出：支持一键导出当前所有分组与规则为 json，亦可导入覆盖现有配置。
- 搜索：支持全局搜索接口名/地址。
- 规则批量操作：在配置页勾选规则后，支持“批量删除”和“移动规则至指定分组”。

### 新增：请求记录功能

- 自动记录页面发起的真实网络请求（XHR/Fetch），并保存返回数据，按域名分组展示。
- 若命中“直接返回 Mock”的规则（normal/swagger），则不记录（避免重复与污染）。
- 访问方式：配置页右上角“请求记录”按钮进入 `records.html`。
- 列表能力：
  - 搜索（URL/方法/请求体/响应体）。
  - 批量勾选并“一键设为 Mock 规则”。
  - 一键设为 Mock 规则支持分组选择：当配置中存在多个分组时，会先弹出“选择分组”对话框，确认后新增规则将分配到所选分组（仅多分组时弹出）。
  - 清空单个域名记录 / 清空全部记录。
  - 批量删除（多选后显示“批量删除”）。
  - 查看详情弹窗（请求体/响应体 Tab）。
- 存储策略与限制：
  - 每域名最多保留 200 条，超过自动丢弃旧记录。
  - 记录体积限制：请求体最多 100KB，响应体最多 200KB（超出会被截断）。
  - 简单去重：同域名 24h 内 URL+Method+RequestBody 重复将去重保留一条。
  - 记录仅保存在本地 `chrome.storage.local`，不上传。

#### 记录过滤设置（右侧设置抽屉）

- 在“请求记录”页右上角点击“设置”，从右侧弹出设置抽屉，可配置：
  - 域名白名单：每行一个域名或完整地址；留空表示全部域名。
  - URL 过滤：可添加多条，支持“包含 / 路径匹配 / 正则匹配”；留空表示全部 URL。
- 设置保存到 `chrome.storage.local.__recorderSettings`，并即时同步给页面脚本，后续仅记录符合条件的请求。

#### 与配置页的无刷新联动

- 在“请求记录”页勾选生成 Mock 规则后，配置页会通过 `chrome.storage.onChanged` 自动更新列表与计数，无需手动刷新。

#### 一键生成规则的相对地址

- 从记录生成规则时会自动把完整 URL 转为相对路径（pathname+search），以便同一条规则在测试/灰度/生产等多域名环境复用。
- 从记录创建的规则默认匹配方式为 contains。

### 快速上手

1. 打开配置页，确认顶部“全局 Mock 开关”已开启。
2. 新建分组（建议配置“网站域名”，多个用逗号分隔，限定该组规则仅对这些域名生效）。
3. 选择“添加”：
   - 手动编辑：设置匹配方式、方法、URL、状态码、延迟、返回数据等。
   - Swagger 生成：设置 Mock 方式=swagger，选择 API 自动生成数据。
   - 请求记录生成：进入“请求记录”，勾选后“一键设为 Mock 规则”（若存在多个分组会先弹出“选择分组”），再回到分组编辑。
4. 在规则列表中开启对应开关，刷新业务页面观察 Mock 效果。
5. 可随时导出/导入配置，或一键重置。

### 字段说明（常用）

- 分组：
  - `label`：组名
  - `pageDomain`：生效域名（留空则全站有效）
  - `apiDocUrl`：Swagger 文档地址
  - `requestHeaders`：拉取 Swagger 文档所需请求头
  - `dataWrapper`：生成返回数据时的统一包裹结构
- 规则：
  - `mockWay`：normal/swagger/redirect/modifyHeaders/modifyRequestBody
  - `filterType`：contains/equals/regexp
    - 从“请求记录”创建规则时默认 `filterType=contains`。
  - `method`：GET/POST/PUT/DELETE/…
  - `apiUrl`：接口地址（支持相对/绝对；从记录生成的规则默认存相对路径，提升跨域名复用性）
  - `requestBody`：请求体（JSON），配置后需完全匹配才命中
  - `mockResponseData`：返回数据（JSON 字符串，保存时自动格式化/校验）
  - `statusCode`：HTTP 状态码，默认 200
  - `delay`：延迟（毫秒）

#### 配置页：规则批量操作

- 勾选规则后，工具栏会显示：
  - “批量删除”：删除选中的规则。
  - “移动规则至”：弹窗选择目标分组，确认后将所选规则移动到该分组（若移动到当前分组，则会将所选规则置顶）。

### 常见问题（FAQ）

- Mock 未生效？
  - 确认“全局 Mock 开关”与单条规则开关开启。
  - 检查请求方法、URL 与匹配方式是否一致。
  - 若配置了 Request Body，确保请求体 JSON 结构完全一致。
  - 检查分组的 `pageDomain` 是否匹配当前页面域名。
  - 刷新页面（脚本注入于 document_start）。
- 返回数据为空或编辑弹窗报 JSON 解析错误？
  - 现已自愈：保存/记录生成时会保证 `mockResponseData` 始终为合法 JSON 字符串；旧数据在后台启动时也会自动修复。
- 能配置多少条 Mock？
  - 受 Chrome 本地存储（约 5MB）限制，与单条返回内容大小有关。普通接口可到数百条；若单条非常大（>100KB），请适当精简。
- Swagger 支持？

### 隐私与安全

- 所有规则与请求记录仅存储在本地 `chrome.storage.local`。
- 扩展不向任何服务器上传数据。
- 仅在你主动开启 Mock/记录时在页面注入脚本并工作。

### 已知限制

- 仅对文本/JSON 响应记录内容（Blob/ArrayBuffer 等二进制不会保存）。
- 请求记录不会保留完整响应头（展示为字符串汇总，fetch 场景为空）。
- Swagger 仅支持 V2；V3 请转换或手动配置。

### 故障排查与反馈

- 打开控制台（F12）查看错误信息。
- 检查 `chrome://extensions` → 本扩展的“错误”条目。
- 导出配置 JSON，附上相关规则或页面 URL，便于复现与排查。

祝使用顺利！****
